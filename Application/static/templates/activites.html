<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activities</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/activities.css') }}">

</head>
<body>
    {% include 'nav.html' %}
    <header>
        <h1>Find an Activity</h1>
        <p>Pick an Activity to learn more about.</p>
        <label for="Activity">Activity:</label>
        <select id="Activity" name="Activity" required>
            <option value="" disabled selected>Select an activity</option>
            <option value="09DF0950-D319-4557-A57E-04CD2F63FF42">Arts and Culture</option>
            <option value="13A57703-BB1A-41A2-94B8-53B692EB7238">Astronomy</option>
            <option value="5F723BAD-7359-48FC-98FA-631592256E35">Auto and ATV</option>
            <option value="7CE6E935-F839-4FEC-A63E-052B1DEF39D2">Biking</option>
            <option value="071BA73C-1D3C-46D4-A53C-00D5602F7F0E">Boating</option>
            <option value="A59947B7-3376-49B4-AD02-C0423E08C5F7">Camping</option>
            <option value="07CBCA6A-46B8-413F-8B6C-ABEDEBF9853E">Canyoneering</option>
            <option value="BA316D0F-92AE-4E00-8C80-DBD605DC58C3">Caving</option>
            <option value="B12FAAB9-713F-4B38-83E4-A273F5A43C77">Climbing</option>
            <option value="C11D3746-5063-4BD0-B245-7178D1AD866C">Compass and GPS</option>
            <option value="8C495067-8E94-4D78-BBD4-3379DACF6550">Dog Sledding</option>
            <option value="AE42B46C-E4B7-4889-A122-08FE180371AE">Fishing</option>
            <option value="D72206E4-6CD1-4441-A355-F8F1827466B1">Flying</option>
            <option value="1DFACD97-1B9C-4F5A-80F2-05593604799E">Food</option>
            <option value="3F3ABD16-2C52-4EAA-A1F6-4235DE5686F0">Golf</option>
            <option value="B33DC9B6-0B7D-4322-BAD7-A13A34C584A3">Guided Tours</option>
            <option value="42FD78B9-2B90-4AA9-BC43-F10E9FEA8B5A">Hands-On</option>
            <option value="BFF8C027-7C8F-480B-A5F8-CD8CE490BFBA">Hiking</option>
            <option value="0307955A-B65C-4CE4-A780-EB36BAAADF0B">Horse Trekking</option>
            <option value="8386EEAF-985F-4DE8-9037-CCF91975AC94">Hunting and Gathering</option>
            <option value="5FF5B286-E9C3-430E-B612-3380D8138600">Ice Skating</option>
            <option value="DF4A35E0-7983-4A3E-BC47-F37B872B0F25">Junior Ranger Program</option>
            <option value="B204DE60-5A24-43DD-8902-C81625A09A74">Living History</option>
            <option value="C8F98B28-3C10-41AE-AA99-092B3B398C43">Museum Exhibits</option>
            <option value="4D224BCA-C127-408B-AC75-A51563C42411">Paddling</option>
            <option value="0C0D142F-06B5-4BE1-8B44-491B90F93DEB">Park Film</option>
            <option value="7779241F-A70B-49BC-86F0-829AE332C708">Playground</option>
            <option value="42CF4021-8524-428E-866A-D33097A4A764">SCUBA Diving</option>
            <option value="24380E3F-AD9D-4E38-BF13-C8EEB21893E7">Shopping</option>
            <option value="F9B1D433-6B86-4804-AED7-B50A519A3B7C">Skiing</option>
            <option value="3EBF7EAC-68FC-4754-B6A4-0C38A1583D45">Snorkeling</option>
            <option value="C38B3C62-1BBF-4EA1-A1A2-35DE21B74C17">Snow Play</option>
            <option value="7C912B83-1B1B-4807-9B66-97C12211E48E">Snowmobiling</option>
            <option value="01D717BC-18BB-4FE4-95BA-6B13AD702038">Snowshoeing</option>
            <option value="AE3C95F5-E05B-4A28-81DD-1C5FD4BE88E2">Surfing</option>
            <option value="587BB2D3-EC35-41B2-B3F7-A39E2087AEE">Swimming</option>
            <option value="94369BFD-F186-477E-8713-AE2A745154DA">Team Sports</option>
            <option value="4D06CEED-90C6-4B69-B264-32CC90B69BA6">Tubing</option>
            <option value="8A1C7B17-C2C6-4F7C-9539-EA1E19971D80">Water Skiing</option>
            <option value="0B685688-3405-4E2A-ABBA-E3069492EC50">Wildlife Watching</option>
        </select>
        <button id="load-parks-btn">Load Parks</button>
        <div id="parks-container">Select an activity and click "Load Parks".</div>
    </header>

    <script>
        const apiUrl = 'https://developer.nps.gov/api/v1/thingstodo?api_key=eQ9n5qQfQRqAOk371jbC687ehwsi5b5J1qbaolU2&limit=3400';

        async function fetchAndDisplayParks(apiUrl, targetActivityId) {
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                const parks = data.data || [];

                // Filter parks based on the selected activity
                const filteredParks = parks.filter(park =>
                    park.activities.some(activity => activity.id === targetActivityId)
                );

                const parksContainer = document.getElementById('parks-container');
                parksContainer.innerHTML = '';

                if (filteredParks.length === 0) {
                    parksContainer.innerHTML = '<p>No parks found with the selected activity.</p>';
                } else {
                    filteredParks.forEach(park => {
                        const parkElement = document.createElement('div');
                        parkElement.className = 'park';

                        // Extract related park names
                        const relatedParks = park.relatedParks
                            .map(rp => rp.fullName)
                            .join(', ') || 'Unknown Park';

                        // Park details with Save to Favorites form
                        parkElement.innerHTML = `
                            <div class="park-card">
                                <h2>${relatedParks}</h2>
                                <p><strong>Title:</strong> ${park.title}</p>
                                <p><strong>Description:</strong> ${park.shortDescription || 'No description available.'}</p>
                                <a href="${park.url}" target="_blank">Learn more</a>
                                <form method="POST" action="{{ url_for('save_item') }}">
                                    <input type="hidden" name="item" value="${park.title}">
                                    <button type="submit">Save to Favorites</button>
                                </form>
                            </div>
                        `;

                        parksContainer.appendChild(parkElement);
                    });
                }
            } catch (error) {
                console.error('Error fetching or processing data:', error);
                document.getElementById('parks-container').textContent =
                    'Error loading parks. Please try again later.';
            }
        }

        document.getElementById('load-parks-btn').addEventListener('click', () => {
            const targetActivityId = document.getElementById('Activity').value.trim();

            if (!targetActivityId) {
                alert('Please select an activity.');
                return;
            }

            document.getElementById('parks-container').textContent = 'Loading parks...';
            fetchAndDisplayParks(apiUrl, targetActivityId);
        });
    </script>
</body>
<footer>
</footer>
</html>
